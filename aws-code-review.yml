version: 0.2
shell: bash
commands:
- mkdir /downloads/sonarqube -p
- cd /downloads/sonarqube
- wget https://binaries.sonarsource.com/Distribution/sonar-scanner-cli/sonar-scanner-cli-4.2.0.1873-linux.zip
- unzip sonar-scanner-cli-4.2.0.1873-linux.zip
- mv sonar-scanner-4.2.0.1873-linux /opt/sonar-scanner
- echo -e "sonar.host.url=http://54.169.93.164:9000/ \n  sonar.sourceEncoding=UTF-8 \n sonar.qualitygate.wait=true " >> /opt/sonar-scanner/conf/sonar-scanner.properties
- echo -e "#/bin/bash \n export PATH='$PATH:/opt/sonar-scanner/bin'" >> /etc/profile.d/sonar-scanner.sh
- source /etc/profile.d/sonar-scanner.sh
- sonar-scanner -v
build:
  commands:
  - cd ../..
  - cd /codebuild/output/src*/src
  - sonar-scanner \
    -Dsonar.projectKey=flask-app \
    -Dsonar.sources=. \
    -Dsonar.host.url=http://54.169.93.164:9000 \
    -Dsonar.token=sqp_fd423ba1225b8cfdccf3cdda5e9b140f0307df5c